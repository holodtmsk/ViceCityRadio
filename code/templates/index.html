<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Game Interface</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="profile">
            <div class="avatar">NN</div>
            <div class="name">name_name</div>
            <!-- –í—Å—Ç–∞–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∏–Ω–æ–≤, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–æ–º -->
            <div class="balance">${{ balance }}</div>
            <div class="tickets">
                üéüÔ∏è {{ spins }}
            </div>
        </div>
        
        <div class="slot-game">
            <span class="slot-game-text">SLOT GAME</span>
            <img src="{{ url_for('static', filename='images/slot_machine.png') }}" alt="Slot Machine" class="icon">
            <button class="play-button">PLAY</button>
        </div>

        <div class="container">
            <button id="farming-button" class="start-button">Start Farming</button>
        </div>

        <div class="navigation-bar">
            <div class="nav-item">
                <img src="{{ url_for('static', filename='images/home_icon.png') }}" alt="Home" class="nav-icon">
                <span>Home</span>
            </div>
            <div class="nav-item">
                <img src="{{ url_for('static', filename='images/frens_icon.png') }}" alt="Frens" class="nav-icon">
                <span>Frens</span>
            </div>
            <div class="nav-item">
                <img src="{{ url_for('static', filename='images/wallet_icon.png') }}" alt="Wallet" class="nav-icon">
                <span>Wallet</span>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const farmingButton = document.getElementById('farming-button');

                let farmingInProgress = false;

                farmingButton.addEventListener('click', function () {
                    if (farmingInProgress || farmingButton.classList.contains('collect')) return;

                    farmingInProgress = true;
                    farmingButton.classList.add('farming');
                    farmingButton.innerHTML = 'üéü Farming goods... <span class="countdown">5</span>';

                    let timeLeft = 5;  // –í—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ 5 —Å–µ–∫—É–Ω–¥
                    const countdownInterval = setInterval(() => {
                        timeLeft--;
                        farmingButton.querySelector('.countdown').textContent = timeLeft;

                        if (timeLeft <= 0) {
                            clearInterval(countdownInterval);
                            farmingInProgress = false;
                            farmingButton.classList.remove('farming');
                            farmingButton.classList.add('collect');
                            farmingButton.textContent = 'Collect reward';
                        }
                    }, 1000);
                });

                // –õ–æ–≥–∏–∫–∞ –¥–ª—è —Å–±–æ—Ä–∞ –Ω–∞–≥—Ä–∞–¥—ã
                farmingButton.addEventListener('click', function () {
                    if (!farmingButton.classList.contains('collect')) return;

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    fetch('/collect_reward', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            username: 'telegram_username',  // –í—Å—Ç–∞–≤—å—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
                        }),
                    }).then(response => {
                        return response.json();
                    }).then(data => {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –Ω–æ–≤—ã–º –±–∞–ª–∞–Ω—Å–æ–º
                        document.querySelector('.balance').textContent = `$${data.newBalance}`;
                        document.querySelector('.tickets').textContent = `üéüÔ∏è ${data.newSpins}`;
                    });

                    // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –Ω–∞ "Start Farming" –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã
                    farmingButton.classList.remove('collect');
                    farmingButton.textContent = 'Start Farming';
                });
            });
        </script>
    </div>
</body>
</html>
